name: Backend CI

on:
  push:
    paths:
      - 'backend-services/**'
  pull_request:
    paths:
      - 'backend-services/**'

jobs:
  lint-test:
  runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r backend-services/requirements.txt
          pip install black ruff mypy
      - name: Run ruff
        run: ruff backend-services
      - name: Run black check
        run: black --check backend-services
      - name: Run mypy
        run: mypy backend-services
      - name: Run tests
        run: |
          cd backend-services
          pytest -q
      - name: Security scan (Python)
        run: |
          python -m pip install safety
          safety check --full-report || true
      - name: Secret scan (truffleHog)
        uses: trufflesecurity/trufflehog@v3.67.3
        with:
          scanArguments: --path backend-services --fail
      - name: Audit npm (placeholder)
        run: |
          # If your backend contains npm code, run audit; otherwise skip
          echo "No npm audit configured for backend"
